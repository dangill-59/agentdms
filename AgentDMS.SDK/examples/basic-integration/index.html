<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgentDMS SDK Basic Integration Example</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .viewer-container {
            height: 500px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .controls {
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1><i class="bi bi-file-earmark-image"></i> AgentDMS SDK Basic Integration</h1>
        <p class="lead">This example demonstrates basic integration of AgentDMS SDK components.</p>
        
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5>Document Viewer</h5>
                    </div>
                    <div class="card-body">
                        <div id="viewer" class="viewer-container d-flex align-items-center justify-content-center">
                            <div class="text-center text-muted">
                                <i class="bi bi-file-earmark" style="font-size: 3rem;"></i>
                                <p>Drop a file here or use the controls below</p>
                            </div>
                        </div>
                        
                        <div class="controls">
                            <div class="btn-toolbar" role="toolbar">
                                <div class="btn-group me-2" role="group">
                                    <input type="file" id="fileInput" class="d-none" accept=".jpg,.jpeg,.png,.gif,.bmp,.tiff,.webp,.pdf">
                                    <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                                        <i class="bi bi-folder-open"></i> Open File
                                    </button>
                                    <button class="btn btn-secondary" id="scanBtn">
                                        <i class="bi bi-scan"></i> Scan
                                    </button>
                                </div>
                                
                                <div class="btn-group me-2" role="group">
                                    <button class="btn btn-outline-secondary" id="zoomInBtn">
                                        <i class="bi bi-zoom-in"></i>
                                    </button>
                                    <button class="btn btn-outline-secondary" id="zoomOutBtn">
                                        <i class="bi bi-zoom-out"></i>
                                    </button>
                                    <button class="btn btn-outline-secondary" id="resetZoomBtn">
                                        <i class="bi bi-aspect-ratio"></i>
                                    </button>
                                    <button class="btn btn-outline-secondary" id="rotateBtn">
                                        <i class="bi bi-arrow-clockwise"></i>
                                    </button>
                                </div>
                                
                                <div class="btn-group me-2" role="group">
                                    <button class="btn btn-outline-success" id="annotateBtn">
                                        <i class="bi bi-pencil"></i> Annotate
                                    </button>
                                    <button class="btn btn-outline-primary" id="uploadBtn">
                                        <i class="bi bi-cloud-upload"></i> Upload
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5>Configuration</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="apiUrl" class="form-label">AgentDMS API URL</label>
                            <input type="url" class="form-control" id="apiUrl" value="http://localhost:5249">
                        </div>
                        <button class="btn btn-success btn-sm" id="updateConfigBtn">Update Configuration</button>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header">
                        <h5>File Information</h5>
                    </div>
                    <div class="card-body" id="fileInfo">
                        <p class="text-muted">No file loaded</p>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header">
                        <h5>Status</h5>
                    </div>
                    <div class="card-body">
                        <div id="status" class="text-muted">Ready</div>
                        <div class="progress mt-2" id="progress" style="display: none;">
                            <div class="progress-bar" id="progressBar" role="progressbar"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Include AgentDMS SDK Components -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fabric@5.3.0/dist/fabric.min.js"></script>
    
    <!-- 
    In a real integration, you would either:
    1. Import the SDK as an npm module: import AgentDMS from '@agentdms/sdk'
    2. Or include the built SDK files directly
    
    For this example, we'll include the components directly
    -->
    <script src="../../src/components/viewer.js"></script>
    <script src="../../src/components/scanner.js"></script>
    <script src="../../src/components/annotator.js"></script>
    <script src="../../src/components/uploader.js"></script>
    
    <script>
        // Initialize SDK components
        let viewer, scanner, annotator, uploader;
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeSDK();
            setupEventHandlers();
        });
        
        function initializeSDK() {
            try {
                // Create SDK components
                viewer = window.agentDMSViewer.create('viewer', {
                    allowZoom: true,
                    allowPan: true,
                    allowRotation: true
                });
                
                // Note: Scanner functionality requires Electron environment
                scanner = window.agentDMSScanner.create({
                    autoLoadScanners: false, // Don't auto-load in browser
                    showProgressDialog: true
                });
                
                annotator = window.agentDMSAnnotator.create('viewer', {
                    enableDrawing: true,
                    enableHighlighting: true,
                    enableRedaction: true
                });
                
                uploader = window.agentDMSUploader.create({
                    apiBaseUrl: document.getElementById('apiUrl').value,
                    showProgress: true
                });
                
                showStatus('AgentDMS SDK initialized successfully', 'success');
                
            } catch (error) {
                showStatus('Error initializing SDK: ' + error.message, 'error');
                console.error('SDK initialization error:', error);
            }
        }
        
        function setupEventHandlers() {
            // File input
            document.getElementById('fileInput').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    loadFile(e.target.files[0]);
                }
            });
            
            // Viewer controls
            document.getElementById('zoomInBtn').addEventListener('click', () => viewer.zoomIn());
            document.getElementById('zoomOutBtn').addEventListener('click', () => viewer.zoomOut());
            document.getElementById('resetZoomBtn').addEventListener('click', () => viewer.resetView());
            document.getElementById('rotateBtn').addEventListener('click', () => viewer.rotateClockwise());
            
            // Scan button
            document.getElementById('scanBtn').addEventListener('click', function() {
                showStatus('Scanner functionality requires Electron environment', 'warning');
            });
            
            // Annotation
            document.getElementById('annotateBtn').addEventListener('click', function() {
                if (!viewer.getCurrentFile()) {
                    showStatus('Please load a file first', 'warning');
                    return;
                }
                annotator.toggle();
                updateAnnotationButton();
            });
            
            // Upload
            document.getElementById('uploadBtn').addEventListener('click', async function() {
                try {
                    if (!viewer.getCurrentFile()) {
                        showStatus('No file to upload', 'warning');
                        return;
                    }
                    
                    showStatus('Uploading...', 'info');
                    const result = await uploader.uploadCurrentFile();
                    showStatus('Upload completed successfully', 'success');
                    console.log('Upload result:', result);
                    
                } catch (error) {
                    showStatus('Upload failed: ' + error.message, 'error');
                }
            });
            
            // Configuration
            document.getElementById('updateConfigBtn').addEventListener('click', function() {
                const newUrl = document.getElementById('apiUrl').value;
                uploader.setApiBaseUrl(newUrl);
                showStatus('Configuration updated', 'success');
            });
        }
        
        async function loadFile(file) {
            try {
                showStatus('Loading file...', 'info');
                await viewer.loadFile(file);
                updateFileInfo(file);
                showStatus('File loaded successfully', 'success');
            } catch (error) {
                showStatus('Error loading file: ' + error.message, 'error');
            }
        }
        
        function updateFileInfo(file) {
            const fileInfo = document.getElementById('fileInfo');
            fileInfo.innerHTML = `
                <small>
                    <strong>Name:</strong> ${file.name}<br>
                    <strong>Size:</strong> ${formatFileSize(file.size)}<br>
                    <strong>Type:</strong> ${file.type}<br>
                    <strong>Modified:</strong> ${new Date(file.lastModified).toLocaleDateString()}
                </small>
            `;
        }
        
        function updateAnnotationButton() {
            const btn = document.getElementById('annotateBtn');
            if (annotator.isActive()) {
                btn.classList.add('active');
                btn.innerHTML = '<i class="bi bi-pencil-fill"></i> Exit Annotate';
            } else {
                btn.classList.remove('active');
                btn.innerHTML = '<i class="bi bi-pencil"></i> Annotate';
            }
        }
        
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `text-${type === 'error' ? 'danger' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info'}`;
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    status.textContent = 'Ready';
                    status.className = 'text-muted';
                }, 3000);
            }
        }
        
        function formatFileSize(bytes) {
            const units = ['B', 'KB', 'MB', 'GB'];
            let size = bytes;
            let unitIndex = 0;
            
            while (size >= 1024 && unitIndex < units.length - 1) {
                size /= 1024;
                unitIndex++;
            }
            
            return `${size.toFixed(1)} ${units[unitIndex]}`;
        }
    </script>
</body>
</html>